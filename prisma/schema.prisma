datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  USER
  ADMIN
  FOUNDER
  MENTOR
}

enum VentureType {
  ECOMMERCE
  SAAS
  SERVICE
  MARKETPLACE
  AGENCY
  OTHER
}

enum VentureStatus {
  IDEATION
  IN_PROGRESS
  LAUNCHED
  PAUSED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum SquadRole {
  LEAD    // Squad Lead (decision maker, founder)
  MEMBER  // Regular member
  GUEST   // Observer only (limited access)
}

// ============================================
// ADMIN SYSTEM - Applications
// ============================================

model FounderApplication {
  id              String   @id @default(cuid())
  name            String
  email           String   @unique
  phone           String?
  instagram       String?
  why             String?  @db.Text
  role            String?  // 'investor', 'builder'
  capital         String?
  skill           String?
  status          ApplicationStatus @default(PENDING)
  notionId        String?  // Optional: Link to Notion if needed

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([status])
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  CONTACTED
}

// ============================================
// LEGAL STUDIO - Document Types & Status
// ============================================

enum LegalDocumentType {
  NDA                 // Non-Disclosure Agreement (Mutual or One-Way)
  SERVICE_AGREEMENT   // Service Provider / Freelancer Contract
  PARTNERSHIP         // B2B Partnership Agreement
  SUPPLIER_CONTRACT   // Manufacturer / Supplier Terms
  EMPLOYMENT          // Employment Contract (Mini-Job, Freelance)
  CUSTOM              // Custom template
}

enum LegalDocumentStatus {
  DRAFT       // Being edited
  REVIEW      // Ready for review
  SENT        // Sent to partner
  SIGNED      // Both parties signed
  ARCHIVED    // No longer active
  REJECTED    // Partner declined
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  role          Role      @default(USER)
  notionId      String?   @unique
  onboardingComplete Boolean @default(false)

  // Relations
  squadMemberships SquadMember[]

  voteResponses VoteResponse[]
  roadmapVotes  RoadmapVote[]
  createdDecisions Decision[]
  karma         Karma[]
  forumVotes    ForumVote[]
  ventures      Venture[]
  ventureTasks  VentureTask[]
  mentoringSessions MentoringSession[]
  moderationWarnings ModerationWarning[]
  legalDocuments LegalDocument[]
  marketingContents MarketingContent[]
  createdSamples    Sample[]
  createdOrders     ProductionOrder[]
  createdCampaigns  MarketingCampaign[]
  createdPosts      ContentPost[]

  // NextAuth
  accounts      Account[]
  sessions      Session[]

  // Moderation
  toxicityWarnings Int      @default(0)
  isBanned         Boolean  @default(false)
  banReason        String?
  bannedAt         DateTime?
  
  // AI Credits System (Freemium)
  credits          Int      @default(50)

  // Stripe Subscription (69€/mo Platform Fee)
  stripeCustomerId      String?  @unique
  stripeSubscriptionId  String?  @unique
  subscriptionStatus    String?  // active, cancelled, past_due, trialing
  subscriptionTier      String   @default("founder") // founder, pro, enterprise
  subscriptionEndsAt    DateTime?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Squad {
  id          String   @id @default(cuid())
  name        String
  description String?
  slug        String   @unique

  // Stripe Connect (Squad erhält Zahlungen)
  stripeConnectedAccountId String?  @unique
  stripeAccountStatus      String?  // pending, enabled, disabled, rejected
  stripeOnboardingComplete Boolean  @default(false)
  stripeChargesEnabled     Boolean  @default(false) // Kann Squad Zahlungen empfangen?
  stripePayoutsEnabled     Boolean  @default(false) // Kann Squad auszahlen?

  members     SquadMember[]
  roadmaps    RoadmapItem[]
  decisions   Decision[]
  ventures    Venture[]
  transactions SquadTransaction[]
  legalDocuments LegalDocument[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============================================
// SQUAD MEMBERSHIP - Many-to-Many System
// ============================================

model SquadMember {
  id          String    @id @default(cuid())

  // Relations
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  squadId     String
  squad       Squad     @relation(fields: [squadId], references: [id], onDelete: Cascade)

  // Role & Permissions
  role        SquadRole @default(MEMBER)

  // Equity & Ownership (optional for revenue sharing)
  equityShare Float?    // Percentage: 20.5 = 20.5%

  // Timestamps
  joinedAt    DateTime  @default(now())
  leftAt      DateTime? // Track when they left (soft delete)

  // Prevent duplicate memberships
  @@unique([userId, squadId])
  @@index([userId])
  @@index([squadId])
  @@index([role])
}

model RoadmapItem {
  id          String   @id @default(cuid())
  title       String
  description String?
  status      String   @default("PLANNED") // PLANNED, IN_PROGRESS, DONE
  
  squadId     String
  squad       Squad    @relation(fields: [squadId], references: [id])
  
  votes       RoadmapVote[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model RoadmapVote {
  id            String      @id @default(cuid())
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  roadmapItemId String
  roadmapItem   RoadmapItem @relation(fields: [roadmapItemId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime    @default(now())

  @@unique([userId, roadmapItemId]) // Prevent duplicate votes
}

model Decision {
  id            String      @id @default(cuid())
  squadId       String
  squad         Squad       @relation(fields: [squadId], references: [id], onDelete: Cascade)
  ventureId     String?
  venture       Venture?    @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  // Question
  question      String
  description   String?     @db.Text
  type          String      @default("multiple-choice") // multiple-choice, yes-no, ranking
  options       String[]    // For multiple choice

  // Status
  status        String      @default("open") // open, closed
  deadline      DateTime?

  // Results
  requiredQuorum   Int      @default(50) // % of members required to vote
  winningThreshold Int      @default(50) // % required to win
  winningOption    String?

  // Relations
  responses     VoteResponse[]

  // Metadata
  createdById   String?
  createdBy     User?       @relation(fields: [createdById], references: [id], onDelete: SetNull)
  createdAt     DateTime    @default(now())
  closedAt      DateTime?

  @@index([squadId])
  @@index([status])
}

model VoteResponse {
  id            String      @id @default(cuid())
  decisionId    String
  decision      Decision    @relation(fields: [decisionId], references: [id], onDelete: Cascade)
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Response
  choice        String
  comment       String?

  // Metadata
  votedAt       DateTime    @default(now())

  @@unique([decisionId, userId]) // One vote per user per decision
  @@index([decisionId])
  @@index([userId])
}

model ForumVote {
  id        String   @id @default(cuid())
  postId    String   // Notion Page ID (No Relation because Posts are in Notion)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  voteType  Int      // 1 (Up) or -1 (Down)
  createdAt DateTime @default(now())

  @@unique([postId, userId]) // Prevent double voting
  @@index([postId])
}

model Karma {
  id        String   @id @default(cuid())
  points    Int
  reason    String
  
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Optional: Link to specific actions
  squadId   String?  // Context for the karma
  
  createdAt DateTime @default(now())

  @@index([squadId]) // Performance index as requested
}

// NextAuth Models
model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
 
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  @@id([provider, providerAccountId])
}
 
model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
 
model VerificationToken {
  identifier String
  token      String
  expires    DateTime
 
  @@id([identifier, token])
}

// ============================================
// VENTURE CREATION SYSTEM
// ============================================

model Venture {
  id              String        @id @default(cuid())
  name            String
  description     String?
  type            VentureType   @default(OTHER)
  status          VentureStatus @default(IDEATION)

  // Wizard Progress
  currentStep     Int           @default(1)
  completedSteps  Int[]         @default([])

  // Business Data
  productType     String?
  targetMarket    String?
  brandColors     String?       // JSON: ["#hex1", "#hex2"]
  logoUrl         String?
  pricing         Json?         // Flexible pricing structure
  marketingBudget Float?
  totalBudget     Float?
  estimatedRevenue Float?

  // Deadlines & Tracking
  launchDate      DateTime?
  lastActivityAt  DateTime      @default(now())

  // Relations
  ownerId         String
  owner           User          @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  squadId         String?
  squad           Squad?        @relation(fields: [squadId], references: [id])

  tasks           VentureTask[]
  steps           VentureStep[]
  costs           CostItem[]
  resources       VentureResource[]
  mentoringSessions MentoringSession[]
  brandDNA        BrandDNA?
  legalDocuments  LegalDocument[]
  marketingContents MarketingContent[]
  suppliers       Supplier[]
  samples         Sample[]
  productionOrders ProductionOrder[]
  campaigns       MarketingCampaign[]
  posts           ContentPost[]
  decisions       Decision[]

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([ownerId])
  @@index([squadId])
  @@index([status])
}

// ============================================
// BRAND DNA - AI Context System
// ============================================

model BrandDNA {
  id              String   @id @default(cuid())
  ventureId       String   @unique
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  // Core Identity
  brandName       String
  tagline         String?
  mission         String?   // "Why we exist"
  vision          String?   // "Where we're going"
  values          String[]  @default([]) // ["Sustainability", "Innovation"]

  // Voice & Tone (for AI content generation)
  toneOfVoice     String?   // "Professional", "Casual", "Edgy", "Friendly"
  personality     String[]  @default([]) // ["Bold", "Playful", "Authentic"]
  writingStyle    String?   // "Short & punchy", "Detailed & informative"

  // Target Audience
  targetAudience  Json?     // { age: "25-35", gender: "all", location: "EU", interests: [] }
  customerPersona String?   // Free text description

  // Visual Identity
  primaryColor    String?   // "#D4AF37"
  secondaryColors String[]  @default([]) // ["#000000", "#FFFFFF"]
  logoUrl         String?
  fontFamily      String?   // "Inter, sans-serif"

  // Product/Service
  productCategory String?   // "Fashion", "Food", "SaaS"
  keyFeatures     String[]  @default([]) // ["Organic", "Handmade", "Sustainable"]
  usp             String?   // Unique Selling Proposition

  // Competitors (for context)
  competitors     Json?     // [{ name: "Brand X", url: "...", strengths: [] }]

  // AI Context (Most Important!)
  aiContext       String?   // Free text for Gemini: "Always mention sustainability..."
  doNotMention    String[]  @default([]) // Topics to avoid in AI responses

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([ventureId])
}

// ============================================
// LEGAL STUDIO - Document Management
// ============================================

model LegalDocument {
  id              String              @id @default(cuid())

  // Relations
  ventureId       String
  venture         Venture             @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  squadId         String?
  squad           Squad?              @relation(fields: [squadId], references: [id], onDelete: SetNull)

  createdById     String
  createdBy       User                @relation(fields: [createdById], references: [id], onDelete: Restrict)

  // Document Details
  documentType    LegalDocumentType
  documentTitle   String              // "NDA with Supplier XYZ"
  status          LegalDocumentStatus @default(DRAFT)

  // AI Generation Context
  aiPrompt        String?             @db.Text // Original prompt used
  generatedContent String?            @db.Text // AI-generated contract text

  // Partner Information
  partnerCompanyName    String?
  partnerContactName    String?
  partnerContactEmail   String?
  partnerContactPhone   String?
  partnerAddress        String?       @db.Text

  // Contract Terms (JSON for flexibility)
  contractTerms   Json?               // { duration: "12 months", payment: "Net 30", scope: "..." }

  // File Storage
  documentUrl     String?             // PDF export URL (Vercel Blob)
  signatureUrl    String?             // E-Signature service URL (DocuSign, HelloSign)

  // Metadata
  version         Int                 @default(1) // Track revisions
  notes           String?             @db.Text

  // Timestamps
  sentAt          DateTime?           // When sent to partner
  signedAt        DateTime?           // When both parties signed
  expiresAt       DateTime?           // Contract expiry date

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  // Performance Indexes
  @@index([ventureId])
  @@index([squadId])
  @@index([createdById])
  @@index([status])
  @@index([documentType])
  @@index([createdAt])
}

model VentureStep {
  id              String   @id @default(cuid())
  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  stepNumber      Int
  stepName        String
  status          String   @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED
  data            Json?    // Step-specific data

  completedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([ventureId, stepNumber])
  @@index([ventureId])
}

model VentureTask {
  id              String       @id @default(cuid())
  title           String
  description     String?
  status          String       @default("TODO") // TODO, IN_PROGRESS, DONE, BLOCKED
  priority        TaskPriority @default(MEDIUM)

  // Deadlines
  dueDate         DateTime?
  completedAt     DateTime?
  overdueNotifiedAt DateTime?  // Track when mentor was notified

  // Relations
  ventureId       String
  venture         Venture      @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  assignedToId    String?
  assignedTo      User?        @relation(fields: [assignedToId], references: [id])

  // Template Data
  isFromTemplate  Boolean      @default(false)
  templateOrder   Int?

  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([ventureId])
  @@index([assignedToId])
  @@index([dueDate])
  @@index([status])
}

model VentureTemplate {
  id              String   @id @default(cuid())
  name            String
  description     String?
  type            VentureType

  // Template Data
  defaultSteps    Json     // Array of step configs
  defaultTasks    Json     // Array of task templates with deadlines
  estimatedDuration Int?   // Days to complete

  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type])
}

model CostItem {
  id              String   @id @default(cuid())
  category        String   // MARKETING, DEVELOPMENT, OPERATIONS, etc.
  name            String
  amount          Float
  isRecurring     Boolean  @default(false)
  frequency       String?  // MONTHLY, YEARLY, ONCE

  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([ventureId])
  @@index([category])
}

model Resource {
  id              String   @id @default(cuid())
  title           String
  description     String?
  category        String   // B2B_DIRECTORY, TEMPLATE, TOOL, GUIDE
  type            String?  // SUPPLIER, MANUFACTURER, SERVICE

  // Resource Data
  url             String?
  contactEmail    String?
  contactInfo     Json?
  tags            String[] @default([])

  // B2B Specific
  minOrderQty     Int?
  priceRange      String?
  location        String?

  isPublic        Boolean  @default(true)
  ventures        VentureResource[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([category])
  @@index([type])
}

model VentureResource {
  id              String   @id @default(cuid())
  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  resourceId      String
  resource        Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  notes           String?
  createdAt       DateTime @default(now())

  @@unique([ventureId, resourceId])
  @@index([ventureId])
  @@index([resourceId])
}

model MentoringSession {
  id              String   @id @default(cuid())
  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  mentorId        String
  mentor          User     @relation(fields: [mentorId], references: [id])

  reason          String   // DEADLINE_OVERDUE, REQUESTED, SCHEDULED
  notes           String?
  outcome         String?

  scheduledAt     DateTime?
  completedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([ventureId])
  @@index([mentorId])
}

model ModerationWarning {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  reason          String   // AI-detected reason (toxicity, spam, harassment, etc.)
  content         String   // The content that triggered the warning
  severity        String   // LOW, MEDIUM, HIGH
  warningNumber   Int      // 1, 2, 3 (helps track which warning this is)

  acknowledged    Boolean  @default(false)
  acknowledgedAt  DateTime?

  createdAt       DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model LinkPreview {
  id              String   @id @default(cuid())
  url             String   @unique

  // Metadata from OpenGraph/Twitter Cards
  title           String?
  description     String?
  image           String?
  siteName        String?

  // AI-generated summary
  aiSummary       String?

  // Cache control
  fetchedAt       DateTime @default(now())
  expiresAt       DateTime? // Cache expiry

  @@index([url])
  @@index([fetchedAt])
}

// ============================================
// MARKETING STUDIO - Content Generation
// ============================================

model MarketingContent {
  id              String   @id @default(cuid())
  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)
  
  contentType     String   // 'instagram', 'blog', 'email', etc.
  prompt          String   @db.Text
  generatedContent String  @db.Text
  
  createdAt       DateTime @default(now())
  
  createdById     String
  createdBy       User     @relation(fields: [createdById], references: [id])

  @@index([ventureId])
  @@index([createdById])
  @@index([contentType])
}


// ============================================
// STRIPE CONNECT - TRANSACTION LOG
// ============================================
// WICHTIG: Dies ist NUR ein Log für Transparenz!
// Wir halten KEIN Geld! Alle Gelder laufen über Stripe Connect.

enum TransactionType {
  SALE              // Squad verkauft Produkt (Shop)
  REFUND            // Rückerstattung
  PLATFORM_FEE      // Unsere Provision (automatisch von Stripe)
  PAYOUT            // Squad zahlt aus (Stripe → Squad Bank)
  SUBSCRIPTION      // User zahlt 69€/mo (geht an uns)
}

enum TransactionStatus {
  PENDING           // Zahlung wird verarbeitet
  SUCCEEDED         // Erfolgreich
  FAILED            // Fehlgeschlagen
  REFUNDED          // Rückerstattet
}

model SquadTransaction {
  id              String   @id @default(cuid())

  // Relation
  squadId         String
  squad           Squad    @relation(fields: [squadId], references: [id], onDelete: Cascade)

  // Transaction Details
  type            TransactionType
  status          TransactionStatus @default(PENDING)
  amount          Float    // In EUR (oder currency)
  currency        String   @default("EUR")

  // Stripe IDs (für Nachverfolgung, NICHT für Geld-Holding!)
  stripePaymentIntentId    String?  @unique
  stripeChargeId           String?
  stripeTransferId         String?  // Transfer zu Squad Connected Account

  // Platform Fee (unsere Provision)
  platformFeeAmount Float?  // z.B. 5€ bei 100€ Sale
  platformFeePercent Float? // z.B. 5.0 (= 5%)

  // Description & Metadata
  description     String?
  metadata        Json?    // Flexible Daten (order_id, customer_email, etc.)

  // Related Order/Customer (optional)
  customerEmail   String?
  orderId         String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([squadId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@index([stripePaymentIntentId])
}

// ============================================
// MARKETING STUDIO - Campaign Management
// ============================================

model MarketingCampaign {
  id              String   @id @default(cuid())
  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  // Campaign Info
  name            String
  description     String?  @db.Text
  goal            String?  // 'awareness', 'conversion', 'engagement'

  // Timeline
  startDate       DateTime?
  endDate         DateTime?

  // Budget (optional)
  budgetAmount    Float?
  budgetCurrency  String   @default("EUR")
  spentAmount     Float?

  // Status
  status          CampaignStatus @default(DRAFT)

  // Relations
  posts           ContentPost[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String
  createdBy       User     @relation(fields: [createdById], references: [id])

  @@index([ventureId])
  @@index([status])
}

enum CampaignStatus {
  DRAFT          // In Planung
  ACTIVE         // Läuft
  PAUSED         // Pausiert
  COMPLETED      // Abgeschlossen
  ARCHIVED       // Archiviert
}

model ContentPost {
  id              String   @id @default(cuid())
  campaignId      String?
  campaign        MarketingCampaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)

  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  // Content
  title           String
  content         String   @db.Text
  contentType     String   // 'instagram', 'blog', 'email', etc.

  // Scheduling
  status          PostStatus @default(DRAFT)
  scheduledFor    DateTime?
  publishedAt     DateTime?

  // Channel-Specific
  platform        String?  // 'instagram', 'linkedin', 'twitter', 'email'
  externalId      String?  // ID from social platform (if posted via API)
  externalUrl     String?  // URL to published post

  // Media
  imageUrls       String[] // Attached images

  // Performance (optional, für später)
  views           Int?
  likes           Int?
  comments        Int?
  shares          Int?
  clicks          Int?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String
  createdBy       User     @relation(fields: [createdById], references: [id])

  @@index([campaignId])
  @@index([ventureId])
  @@index([status])
  @@index([scheduledFor])
}

enum PostStatus {
  DRAFT          // Nicht fertig
  READY          // Bereit zum Planen
  SCHEDULED      // Geplant für Datum X
  PUBLISHED      // Veröffentlicht
  FAILED         // Fehler beim Posten
  ARCHIVED       // Archiviert
}

// ============================================
// SOURCING STUDIO - Supplier Management
// ============================================

model Supplier {
  id              String   @id @default(cuid())
  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  // Basic Info
  companyName     String
  contactName     String?
  email           String?
  phone           String?
  website         String?
  address         String?  @db.Text
  country         String?

  // Categories
  category        String   // 'fabric', 'manufacturer', 'packaging', 'logistics'
  specialization  String?  // e.g., 'Organic Cotton', 'Screen Printing'

  // Business Details
  moq             Int?     // Minimum Order Quantity
  leadTimeDays    Int?     // Production lead time
  paymentTerms    String?  // e.g., "50% upfront, 50% on delivery"

  // Rating & Notes
  rating          Int?     // 1-5 stars
  notes           String?  @db.Text
  tags            String[] // ['sustainable', 'fast', 'premium']

  // Relations
  samples         Sample[]
  orders          ProductionOrder[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([ventureId])
  @@index([category])
  @@index([country])
}

model Sample {
  id              String   @id @default(cuid())
  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  supplierId      String
  supplier        Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  // Sample Details
  productName     String
  description     String?  @db.Text
  quantity        Int?
  cost            Float?
  currency        String   @default("EUR")

  // Status Tracking
  status          SampleStatus @default(REQUESTED)
  orderedAt       DateTime?
  receivedAt      DateTime?

  // Quality Assessment
  approved        Boolean?
  qualityRating   Int?     // 1-5 stars
  feedback        String?  @db.Text

  // Files
  imageUrls       String[] // Vercel Blob URLs
  specFileUrls    String[] // Technical specs, PDFs

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String
  createdBy       User     @relation(fields: [createdById], references: [id])

  @@index([ventureId])
  @@index([supplierId])
  @@index([status])
}

enum SampleStatus {
  REQUESTED      // Sample requested
  ORDERED        // Order placed
  IN_TRANSIT     // Shipped
  RECEIVED       // Arrived
  APPROVED       // Quality check passed
  REJECTED       // Quality check failed
}

model ProductionOrder {
  id              String   @id @default(cuid())
  ventureId       String
  venture         Venture  @relation(fields: [ventureId], references: [id], onDelete: Cascade)

  supplierId      String
  supplier        Supplier @relation(fields: [supplierId], references: [id])

  // Order Details
  orderNumber     String   // e.g., "PO-2025-001"
  productName     String
  description     String?  @db.Text
  quantity        Int
  unitPrice       Float
  totalPrice      Float
  currency        String   @default("EUR")

  // Timeline
  orderDate       DateTime @default(now())
  expectedDelivery DateTime?
  actualDelivery  DateTime?

  // Status & Payment
  status          OrderStatus @default(DRAFT)
  paymentStatus   PaymentStatus @default(PENDING)
  depositPaid     Float?
  finalPaid       Float?

  // Files & Notes
  poFileUrl       String?  // Purchase Order PDF
  invoiceUrls     String[] // Invoices
  notes           String?  @db.Text

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String
  createdBy       User     @relation(fields: [createdById], references: [id])

  @@index([ventureId])
  @@index([supplierId])
  @@index([status])
}

enum OrderStatus {
  DRAFT          // Not sent yet
  SENT           // PO sent to supplier
  CONFIRMED      // Supplier confirmed
  IN_PRODUCTION  // Manufacturing
  SHIPPED        // On the way
  DELIVERED      // Received
  COMPLETED      // Closed
  CANCELLED      // Cancelled
}

enum PaymentStatus {
  PENDING        // Not paid
  DEPOSIT_PAID   // Partial payment
  FULLY_PAID     // Paid in full
  REFUNDED       // Money returned
}
